##########
# keymap
##########
set -g prefix C-t

# Asegurarnos de que TMUX no captura control-n control-p
unbind -n C-n
unbind -n C-p

# 24-bit color support in tmux
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:RGB"

#reload config
# bind r source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'
bind r source-file ~/.config/tmux/tmux.conf \; display '~/.config/tmux/tmux.conf sourced'

# Clipboard
set -g set-clipboard on

# set default shell
set -g default-shell /usr/bin/zsh

# History limit
set -g history-limit 50000
#############
# Movement
#############

#to last window ( quick switch )
bind-key C-t last-window

#movement between panes (use vim keys)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# pane swapping
bind -r > swap-pane -D
bind -r < swap-pane -U

# pane breaking: use 'b' to create a new window from a pane
bind-key b break-pane

# pane joining
bind-key a command-prompt -p "join pane from:" "join-pane -s '%%'"
bind-key S command-prompt -p "send pane to window number:" "joinp -t :'%%'"

# pane renaming
bind-key @ command-prompt -p "Título del panel: " "select-pane -T '%%'"
#split windows
bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"

# new window
bind-key c new-window -c "#{pane_current_path}"

###################
# Manipulate windows
###################
# Move a window from another session to the current session
# it shows all the sessions and windows in a tree format for you to choose
bind-key g choose-tree -Zw -w 'move-window -s %% -t :'


# Copy(link) a window from another session to the current session
# it shows all the sessions and windows in a tree format for you to choose
bind-key G choose-tree -Zw -w 'link-window -s %% -t :'

##########
# Sessions
##########
# 3) Versión robusta: si ya existe, no falla (muestra un mensaje), si no, la crea
# --- Crear sesión: pide nombre y la crea (silenciosamente si ya existe) ---
bind-key N command-prompt -p "Nombre de sesión:" \
  'if -F "#{session_exists:%1}" \
      "display-message \"La sesión \\\"%1\\\" ya existe\"" \
      "new-session -Ad -s %1; switch-client -t %1"'
      # "new-session -Ad -s %1"'      
##########
# Status
##########
set -g status on
set -g status-position top
set -g status-justify left
set -g status-left-length 200
set -g status-right-length 200
set -g status-style 'bg=#1e1e2e'

# Status Windows
setw -g window-status-current-style bold

# Aviod renaming by apps
setw -g automatic-rename off
set -g allow-rename off
##########
# Windows
##########
set -g base-index 1

# renumber windows when closed.
set -g renumber-windows on

setw -g aggressive-resize on

##########
# Panes
##########
setw -g pane-base-index 1

# pane configuration (seems not to work )
# Warning: Catppuccin seems to be overriding this
# See Catppuccin plugin configuration below for more info
# show pane status ( with name ) on top
set -g pane-border-status top
# name pane after index and title
set -g pane-border-format "#{pane_index} #{pane_current_path}"

##########
# Mouse
##########

# Linux only
set -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi    C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-vi    C-WheelDownPane send-keys -X halfpage-down
bind -T copy-mode-emacs C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-emacs C-WheelDownPane send-keys -X halfpage-down

# To copy, left click and drag to highlight text in yellow, 
# once you release left click yellow text will disappear and will automatically be available in clibboard
# # Use vim keybindings in copy mode
setw -g mode-keys vi
# Update default binding of `Enter` to also use copy-pipe
unbind -T copy-mode-vi Enter
#bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection c"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xsel -b"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xsel -ib"
##########
# TEsts
##########

# Nota: se pueden crear bindings con mas de una tecla creando "tablas"
# ej: La primera linea enlaza <prefix> + 'v' a la tabla "prefix_v"
#     La segunda linea define que para la table "prefix_v" 'G' abre una nueva ventana y llama a 'nvim' 
# bind-key -T prefix v switch-client -T prefix_v
# bind-key -T prefix_v G split-window "nvim +$"



##########
# plugins
# note: This need tpm installed
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Note: Need to press 'prefix + I' to download and load listed plugings 
##########
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux#v2.1.3' # See https://github.com/catppuccin/tmux/tags for additional tags
set -g @catppuccin_flavor 'mocha' # latte, frappe, macchiato or mocha
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-yank'

# Load catppuccin
#run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux
# For TPM, instead use 
#run ~/.tmux/plugins/tmux/catppuccin.tmux

# Make the status line pretty and add some modules
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -g status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"
set -agF status-right "#{E:@catppuccin_status_battery}"
set -g @catppuccin_status_background "none" # default (system color), none (transparent) 

# ======================================================================================
# Menu styling options
set -g @catppuccin_menu_selected_style "fg=#{@thm_fg},bold,bg=#{@thm_overlay_0}"

# Pane styling options
set -g @catppuccin_pane_status_enabled "yes" # "no", set to "yes" to enable
set -g @catppuccin_pane_border_status "yes" # "off", set to "yes" to enable
set -g @catppuccin_pane_border_style "fg=#{@thm_overlay_1}"
set -g @catppuccin_pane_active_border_style "##{?pane_in_mode,fg=#{@thm_lavender},##{?pane_synchronized,fg=#{@thm_mauve},fg=#{@thm_green}}}"
set -g @catppuccin_pane_left_separator ""
set -g @catppuccin_pane_right_separator ""
set -g @catppuccin_pane_middle_separator ":"
set -g @catppuccin_pane_color "#{@thm_lavender}"
set -g @catppuccin_pane_background_color "#{@thm_surface_1}"
set -g @catppuccin_pane_default_text "##{b:pane_current_path}"
set -g @catppuccin_pane_default_text "##{b:pane_title}@#{b:pane_current_path}"
set -g @catppuccin_pane_default_fill "number"
set -g @catppuccin_pane_number_position "left" # right, left



set -g @catppuccin_window_status_style "rounded" # basic, rounded, slanted, custom, or none
set -g @catppuccin_window_text_color "#{@thm_surface_0}"
set -g @catppuccin_window_number_color "#{@thm_overlay_2}"
#set -g @catppuccin_window_number_color "none"
set -g @catppuccin_window_text "#W"
set -g @catppuccin_window_number "#I"
set -g @catppuccin_window_current_text_color "#{@thm_surface_1}"
set -g @catppuccin_window_current_number_color "#{@thm_mauve}"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_window_current_number "#I"
set -g @catppuccin_window_current_left_separator ""
set -g @catppuccin_window_current_right_separator " "
set -g @catppuccin_window_current_middle_separator " █"
set -g @catppuccin_window_current_middle_separator ":"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_flags "icon" # none, icon, or text
set -g @catppuccin_window_flags_icon_last " 󰖰" # -
set -g @catppuccin_window_flags_icon_current " 󰖯" # *
set -g @catppuccin_window_flags_icon_zoom " 󰁌" # Z
set -g @catppuccin_window_flags_icon_mark " 󰃀" # M
set -g @catppuccin_window_flags_icon_silent " 󰂛" # ~
set -g @catppuccin_window_flags_icon_activity " 󱅫" # #
set -g @catppuccin_window_flags_icon_bell " 󰂞" # !
# Matches icon order when using `#F` (`#!~[*-]MZ`)
set -g @catppuccin_window_flags_icon_format "##{?window_activity_flag,#{E:@catppuccin_window_flags_icon_activity},}##{?window_bell_flag,#{E:@catppuccin_window_flags_icon_bell},}##{?window_silence_flag,#{E:@catppuccin_window_flags_icon_silent},}##{?window_active,#{E:@catppuccin_window_flags_icon_current},}##{?window_last_flag,#{E:@catppuccin_window_flags_icon_last},}##{?window_marked_flag,#{E:@catppuccin_window_flags_icon_mark},}##{?window_zoomed_flag,#{E:@catppuccin_window_flags_icon_zoom},} "

# Status line options
#set -g @catppuccin_status_left_separator ""
#set -g @catppuccin_status_middle_separator ""
#set -g @catppuccin_status_right_separator "█"
#set -g @catppuccin_status_connect_separator "yes" # yes, no
#set -g @catppuccin_status_fill "icon"
#set -g @catppuccin_status_module_bg_color "#{@thm_surface_0}"

# ======================================================================================



#set -g @catppuccin_flavor "mocha"
#--------------------------------------------------------------------------------------
# config-3
#set -g @catppuccin_window_status_style "rounded" # basic, rounded, slanted, custom, none
#set -g @catppuccin_window_left_separator ""
#set -g @catppuccin_window_right_separator " "
#set -g @catppuccin_window_middle_separator " █"
#set -g @catppuccin_window_number_position "right"
#set -g @catppuccin_window_current_left_separator ""
#set -g @catppuccin_window_current_right_separator " "
#set -g @catppuccin_window_current_middle_separator " █"
##
#set -g @catppuccin_window_fill "number"
#set -g @catppuccin_window_text "#W"
##
#set -g @catppuccin_window_current_fill "number"
#set -g @catppuccin_window_current_text "#W"
##
###set -g @catppuccin_status_modules_right "directory user host session"
##set -g @catppuccin_status_modules_right "user session cpu battery date_time"
#set -g @catppuccin_status_left_separator  " "
#set -g @catppuccin_status_right_separator ""
##set -g @catppuccin_status_right_separator_inverse "no"
##set -g @catppuccin_status_fill "icon"
#set -g @catppuccin_status_connect_separator "no"
##
#set -g @catppuccin_directory_text "#{pane_current_path}"
#set -g @catppuccin_date_time_text "%d-%m-%Y %H:%M:%S"
##
##
#### Catppuccin pane config
#set -g @catppuccin_pane_status_enabled "yes"
#set -g @catppuccin_pane_border_status "top"
#set -g @catppuccin_pane_left_separator ""
#set -g @catppuccin_pane_right_separator ""
#set -g @catppuccin_pane_middle_separator ":"
#set -g @catppuccin_pane_number_position "left"
#set -g @catppuccin_pane_default_fill "number"
#set -g @catppuccin_pane_default_text "#{b:pane_title}"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

